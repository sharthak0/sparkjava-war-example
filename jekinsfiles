pipeline { 
    agent any 
    environment {
        PATH = "/opt/maven/bin:$PATH"
    } 
    stages { 

        stage('Build') { 
            steps { 
                echo 'Build starting...'
                sh 'mvn clean deploy -Dmaven.test.skip=true' 
                echo 'Build ending...'  
            }    
        } 
        
        stage('Test') {
            steps {
                echo 'Test starting...'
                sh 'mvn surefire-report:report'
                echo 'Test ending...'
            }
        }

        stage('SonarQube Analysis') {
            environment {
                scannerHome = tool 'Test-SonarQube Scanner'
            }    
            steps { 
                withSonarQubeEnv('test-SonarQube-server') {  
                    sh '${scannerHome}/bin/sonar-scanner'   
                }  
            } 
        }    
    } 
}

