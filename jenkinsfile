pipeline { 
  agent any 
  environment {
   PATH = "/opt/maven/bin:$PATH"
  } 
  stages { 

      stage ('build') { 
        steps {
           echo 'depoying start..'
           sh 'mvn clean deploy -Dmven.test.skip=true' 
           echo 'deploying end....'
        } 

         
      }  
      
      stage ('test') {
        steps {
           echo 'tsting start..'
             sh 'mvn surefire-repot:report'
           echo 'testing end....'
        }


      }
    
       stage ('SonarQube analysis') {
           environment {
                scannerHome = tool 'Test-SonarQube Scanner'
  
           }    
            steps { 
               withSonarQbeEnv( 'test-SonarQube-server') {  
                                         
                    sh '${scannerhome}/bin/sonar-scanner'   

                }  
            } 
       }    
    
  } 
}
